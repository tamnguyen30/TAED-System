<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAED Phishing Defense</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        body { background: #f4f6f9; font-family: 'Segoe UI', sans-serif; padding-top: 50px; }
        .container { max-width: 850px; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .verdict-badge { padding: 15px; border-radius: 8px; text-align: center; color: white; font-size: 1.8em; font-weight: bold; margin-bottom: 25px; }
        .bg-safe { background: #28a745; }
        .bg-danger { background: #dc3545; }
        .metric-box { background: #f8f9fa; padding: 20px; border-radius: 10px; border: 1px solid #e9ecef; text-align: center; }
        .metric-val { font-size: 1.6em; font-weight: bold; color: #333; }
        .metric-label { font-size: 0.85em; text-transform: uppercase; color: #666; letter-spacing: 1px; margin-top: 5px; }
        textarea { resize: vertical; border-radius: 8px; }
    </style>
</head>
<body>

<div class="container">
    <div class="text-center mb-5">
        <h2 class="fw-bold">üõ°Ô∏è TAED Framework</h2>
        <p class="text-muted">Trust-Aware Explainable Defense System</p>
        <code class="text-primary">Trust Score = (Œ±¬∑Confidence) + (Œ≤¬∑Fidelity) - (Œ≥¬∑Instability)</code>
    </div>

    <textarea id="emailInput" class="form-control mb-3" rows="6" placeholder="Paste suspicious email here..."></textarea>
    <button id="scanBtn" class="btn btn-primary w-100 py-3 fw-bold" onclick="runAnalysis()">ANALYZE EMAIL</button>

    <div id="result-section" style="display: none; margin-top: 30px;">
        <div id="verdict-banner" class="verdict-badge"></div>

        <h5 class="fw-bold mb-3">Trust Mechanics</h5>
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="metric-box">
                    <div id="val-c" class="metric-val text-primary">0.00</div>
                    <div class="metric-label">Confidence (C)</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="metric-box">
                    <div id="val-f" class="metric-val text-success">0.00</div>
                    <div class="metric-label">Fidelity (F)</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="metric-box border-danger">
                    <div id="val-i" class="metric-val text-danger">0.00</div>
                    <div class="metric-label text-danger">Instability (I)</div>
                </div>
            </div>
        </div>

        <div class="alert alert-light border text-center">
            <div class="fs-4 fw-bold mb-2">Final Trust Score: <span id="val-ts">0.00</span></div>
            <p id="explanation-text" class="mb-0 text-muted"></p>
        </div>
    </div>
</div>

<script>
    async function runAnalysis() {
        const text = document.getElementById("emailInput").value;
        if (!text) return alert("Please enter text first.");
        
        document.getElementById("scanBtn").innerText = "Analyzing...";
        
        try {
            const response = await fetch("/analyze", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ text: text })
            });
            const data = await response.json();

            document.getElementById("result-section").style.display = "block";
            document.getElementById("scanBtn").innerText = "ANALYZE EMAIL";

            // Update Verdict
            const banner = document.getElementById("verdict-banner");
            banner.innerText = data.prediction === "PHISHING" ? "üö´ THREAT DETECTED" : "‚úÖ SAFE EMAIL";
            banner.className = "verdict-badge " + (data.prediction === "PHISHING" ? "bg-danger" : "bg-safe");

            // Update Metrics
            document.getElementById("val-c").innerText = data.metrics["C (Confidence)"];
            document.getElementById("val-f").innerText = data.metrics["F (Fidelity)"];
            document.getElementById("val-i").innerText = data.metrics["I (Instability)"];
            document.getElementById("val-ts").innerText = data.trust_score.toFixed(2);
            document.getElementById("explanation-text").innerText = data.natural_language;
            
        } catch (e) {
            alert("Connection Error. Make sure the server is running.");
            document.getElementById("scanBtn").innerText = "ANALYZE EMAIL";
        }
    }
</script>
</body>
</html>
